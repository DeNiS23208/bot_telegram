# Настройка файрвола в Selectel для webhook

## Проблема

Порт 443 (HTTPS) закрыт в группе безопасности, поэтому webhook от ЮKassa не может подключиться.

## Решение

### Шаг 1: Откройте раздел "Группы безопасности"

В левом меню нажмите на **"Группы безопасности"** (Security Groups).

### Шаг 2: Найдите группу "default"

Вы увидите группу безопасности "default", которая применена к вашему серверу.

### Шаг 3: Откройте порты

Нажмите на группу "default" и добавьте следующие правила:

#### Правило 1: HTTP (порт 80)
- **Тип:** Входящий (Ingress)
- **Протокол:** TCP
- **Порт:** 80
- **Источник:** 0.0.0.0/0 (или Anywhere)
- **Описание:** HTTP для редиректа на HTTPS

#### Правило 2: HTTPS (порт 443) - **КРИТИЧНО**
- **Тип:** Входящий (Ingress)
- **Протокол:** TCP
- **Порт:** 443
- **Источник:** 0.0.0.0/0 (или Anywhere)
- **Описание:** HTTPS для webhook от ЮKassa

### Шаг 4: Сохраните изменения

После добавления правил сохраните изменения. Они должны примениться автоматически.

### Альтернативный вариант: Создать новую группу безопасности

Если не хотите менять "default", можно:

1. Создать новую группу безопасности (например, "webhook-ports")
2. Добавить правила для портов 80 и 443
3. Применить эту группу к серверу "Telegram_bot"

## Проверка

После открытия портов проверьте:

```bash
# С вашего компьютера
curl -I https://xasanim.ru/yookassa/webhook

# Или с сервера
ssh root@178.72.153.64 "curl -I https://xasanim.ru/yookassa/webhook"
```

## Важно

- Порты должны быть открыты для **входящих** (Ingress) соединений
- Источник можно оставить `0.0.0.0/0` (любой IP) или ограничить IP адресами ЮKassa
- Изменения применяются сразу, но может потребоваться несколько секунд

## IP адреса ЮKassa (опционально, для безопасности)

Если хотите ограничить доступ только для ЮKassa, используйте их IP:
- 185.71.76.0/27
- 185.71.77.0/27
- 77.75.153.0/25
- 77.75.156.11/32
- 77.75.156.35/32

Но для начала лучше открыть для всех (0.0.0.0/0), чтобы проверить работу.

