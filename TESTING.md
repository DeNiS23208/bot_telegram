# Инструкция по тестированию

## Очистка базы данных для тестов

При тестировании оплаты логика программы может меняться из-за наличия данных в БД (активные подписки, сохраненные платежи и т.д.). Для чистого тестирования нужно очищать базу данных.

### Быстрая очистка БД

Используйте скрипт для автоматической очистки:

```bash
# С вашего компьютера
./reset_db_for_tests.sh

# Или на сервере
ssh root@178.72.153.64
cd /opt/bot_telegram
./reset_db_for_tests.sh
```

### Ручная очистка БД

#### Обычная очистка (только invite_links)

```bash
ssh root@178.72.153.64
cd /opt/bot_telegram
python3 clear_db.py
```

#### Полная очистка (для тестов)

Удаляет все данные: подписки, платежи, approved_users, processed_payments:

```bash
ssh root@178.72.153.64
cd /opt/bot_telegram
python3 clear_db.py --full
```

Или короткая версия:

```bash
python3 clear_db.py -f
```

### Что очищается при полной очистке

- ✅ `subscriptions` - все подписки
- ✅ `payments` - все записи о платежах
- ✅ `approved_users` - список оплативших пользователей
- ✅ `processed_payments` - обработанные платежи
- ✅ `invite_links` - ссылки-приглашения
- ⚠️ `users` - НЕ очищается (можно раскомментировать в коде, если нужно)

### Email для чеков

Email для чеков обновлен на: **hasanov.nn@yandex.ru**

Этот email используется в чеках 54-ФЗ, которые отправляются пользователям при оплате, если они не указали свой email.

### Важно

⚠️ **ВНИМАНИЕ:** Полная очистка удаляет ВСЕ данные о подписках и платежах. Используйте только для тестов!

После полной очистки:
- Пользователям нужно будет оплатить заново
- Все подписки будут удалены
- История платежей будет очищена

### Рекомендации для тестирования

1. **Перед каждым тестом** выполняйте полную очистку БД:
   ```bash
   ./reset_db_for_tests.sh
   ```

2. **После теста** можно оставить данные для проверки или очистить снова

3. **Для продакшена** НЕ используйте полную очистку - это удалит реальные данные пользователей

