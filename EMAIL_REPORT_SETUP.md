# üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ Excel –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ email

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `send_excel_report.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Excel –æ—Ç—á–µ—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞. –§–∞–π–ª—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ - –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–π–ª `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```env
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ email
SMTP_SERVER=smtp.mail.ru
SMTP_PORT=587
SMTP_USER=–≤–∞—à_email@mail.ru
SMTP_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
REPORT_EMAIL=xasanimbuiss@mail.ru
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è Mail.ru

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**, –∞ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å:

1. –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç—ã Mail.ru
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"
3. –°–æ–∑–¥–∞–π—Ç–µ "–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –≤ `SMTP_PASSWORD`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞:

```cron
0 */2 * * * cd /opt/bot_telegram && /opt/bot_telegram/venv/bin/python3 /opt/bot_telegram/send_excel_report.py >> /opt/bot_telegram/logs/email_report.log 2>&1
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd timer (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/email-report.service`:

```ini
[Unit]
Description=Send Excel Report via Email
After=network.target

[Service]
Type=oneshot
User=root
WorkingDirectory=/opt/bot_telegram
Environment="PATH=/opt/bot_telegram/venv/bin:/usr/bin:/bin"
ExecStart=/opt/bot_telegram/venv/bin/python3 /opt/bot_telegram/send_excel_report.py
StandardOutput=append:/opt/bot_telegram/logs/email_report.log
StandardError=append:/opt/bot_telegram/logs/email_report.log
```

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/email-report.timer`:

```ini
[Unit]
Description=Timer for Email Report
Requires=email-report.service

[Timer]
OnCalendar=*-*-* 00,02,04,06,08,10,12,14,16,18,20,22:00:00
Persistent=true

[Install]
WantedBy=timers.target
```

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ timer:

```bash
systemctl daemon-reload
systemctl enable email-report.timer
systemctl start email-report.timer
systemctl status email-report.timer
```

### 4. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤

```bash
mkdir -p /opt/bot_telegram/logs
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
cd /opt/bot_telegram
source venv/bin/activate
python3 send_excel_report.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:

```bash
tail -f /opt/bot_telegram/logs/email_report.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ systemd timer:

```bash
systemctl status email-report.timer
systemctl list-timers email-report.timer
```

## –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –û—Ü–µ–Ω–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel —Ñ–∞–π–ª–∞:**
- CPU: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (~1-2 —Å–µ–∫—É–Ω–¥—ã)
- RAM: ~10-20 MB (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- –î–∏—Å–∫: ~10-50 KB (–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª, —É–¥–∞–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É)
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 2-5 —Å–µ–∫—É–Ω–¥

**–û—Ç–ø—Ä–∞–≤–∫–∞ email:**
- CPU: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (~1 —Å–µ–∫—É–Ω–¥–∞)
- RAM: ~5 MB
- –°–µ—Ç—å: ~50-100 KB (—Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞)
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 1-3 —Å–µ–∫—É–Ω–¥—ã

**–û–±—â–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 3-8 —Å–µ–∫—É–Ω–¥ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
- **–ß–∞—Å—Ç–æ—Ç–∞:** 12 —Ä–∞–∑ –≤ –¥–µ–Ω—å
- **–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~1-2 –º–∏–Ω—É—Ç—ã –≤ –¥–µ–Ω—å
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞:** 0 KB (—Ñ–∞–π–ª—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)

### –í—ã–≤–æ–¥:

‚úÖ **–ù–ï –ö–†–ò–¢–ò–ß–ù–û** –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞. –ù–∞–≥—Ä—É–∑–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞.

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SMTP:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `SMTP_SERVER` –∏ `SMTP_PORT`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—á—Ç–∞ Mail.ru —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ SMTP

### –§–∞–π–ª –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /opt/bot_telegram/logs/email_report.log`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/tmp/`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É

### Cron –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ Python: `which python3`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron: `grep CRON /var/log/syslog`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ Git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É `.env`: `chmod 600 .env`
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

